version: '3.4'
services:
  api:
    container_name: ${CONTAINER:-node-manager-activity}
    hostname: ${SRV}-${CONTAINER:-node-manager-activity}
    image: ${REGISTRY:-672821892059.dkr.ecr.us-east-1.amazonaws.com}/${CONTAINER:-node-manager-activity}:${BUILD_ID:-hom}
    restart: unless-stopped
    ports:
    - ${PORT:-4200}:4200
    environment:
      HOST: $HOST
      SRV: $SRV
      URLHEALTHCHECK: $URLHEALTHCHECK
      AUTH: $AUTH
      TZ: $TZ
      PORT: $PORT
      HML_CERS_DB_HOST: $HML_CERS_DB_HOST
      HML_CERS_DB_NAME: $HML_CERS_DB_NAME
      USER_DB: $USER_DB
      USER_DB_PASSWORD: $USER_DB_PASSWORD
      clientId_Discord: 946172169111601223
      clientSecretDiscord: -64d0g0XYS9tJ-paoQceARYkmqkxY5xG
      callBackDiscord: /auth/discord/redirect
      redirect_url: http://localhost:3000/
      SECRET: a1e3f062caa51fd4651f4b68f270c95f5912b01c4d0d95689603f75b4d34e6b9
    # healthcheck:
    #   test: 
    #     'curl -f --connect-timeout 10 --max-time 10 --retry 3 --retry-delay 10 $URLHEALTHCHECK || bash -c "kill -s 15 -1 && (sleep 10; kill -s 9 -1)"'
    #   interval: 3m
    #   timeout: 120s
    #   retries: 3
